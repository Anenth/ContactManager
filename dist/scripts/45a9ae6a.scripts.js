"use strict";angular.module("ContactManager",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"HomeCtrl"}).when("/add",{templateUrl:"views/add.html",controller:"AddCtrl"}).when("/edit/:id",{templateUrl:"views/add.html",controller:"EditCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("ContactManager").factory("FlashService",["$rootScope",function(a){return{show:function(b,c){a.flash=b,a.flashType=c},clear:function(){a.flash=""}}}]),angular.module("ContactManager").factory("contactService",["$http","$q","FlashService","$location",function(a,b,c,d){var e="anenthvishnu@gmail.com",f="http://ui-proj.practodev.in/contacts",g=function(b,f,g,h){a({method:b,url:f,data:g,headers:{"X-USER":e,"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b){201===b&&h&&(c.show("Contact added","success"),d.path("../"))}).error(function(a){if(h)for(var b in a)c.show(a[b],"danger")})},h=function(a,b){for(var c in a)if(a[c].id==b)return c};return{list:function(){if(navigator.onLine){if(localStorage.getItem("contactsAdded")){var c=JSON.parse(localStorage.getItem("contactsAdded"));for(var d in c)g("POST",f,$.param(c[d]));localStorage.removeItem("contactsAdded")}if(localStorage.getItem("contactsUpdated")){var h,c=JSON.parse(localStorage.getItem("contactsUpdated"));for(var d in c)h=f+"/"+c[d].id,g("PUT",h,$.param(c[d]));localStorage.removeItem("contactsUpdated")}if(localStorage.getItem("contactsDeleted")){var h,c=JSON.parse(localStorage.getItem("contactsDeleted"));for(var d in c)h=f+"/"+c[d],g("DELETE",h);localStorage.removeItem("contactsDeleted")}return a({method:"GET",url:f,headers:{"X-USER":e}}).success(function(a,b){200===b&&localStorage.setItem("contacts",JSON.stringify(a.contacts))})}return b.when(JSON.parse(localStorage.getItem("contacts")))},newContact:function(a){if(navigator.onLine)g("POST",f,a,!0);else{var a=decodeURIComponent(a).replace(/\+/g," "),b=JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'),e=JSON.parse(localStorage.getItem("contacts")),h=JSON.parse(localStorage.getItem("contactsAdded"));e.push(b),h?(h.push(b),localStorage.setItem("contactsAdded",JSON.stringify(h))):localStorage.setItem("contactsAdded",JSON.stringify(Array(b))),localStorage.setItem("contacts",JSON.stringify(e)),c.show("Contact added","success"),d.path("../")}},get:function(c){if(navigator.onLine)return a({method:"GET",url:f+"/"+c,headers:{"X-USER":e}});var d=JSON.parse(localStorage.getItem("contacts")),g=$.grep(d,function(a){return a.id==c});return b.when(g)},update:function(a,b){if(navigator.onLine){var e=f+"/"+a;g("PUT",e,b,!0)}else{var b=decodeURIComponent(b),i=JSON.parse('{"'+decodeURI(b).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'),j=JSON.parse(localStorage.getItem("contacts")),k=JSON.parse(localStorage.getItem("contactsUpdated")),l=h(j,a);j.splice(l,1),j.push(i),k?(k.push(i),localStorage.setItem("contactsUpdated",JSON.stringify(k))):localStorage.setItem("contactsUpdated",JSON.stringify(Array(i))),localStorage.setItem("contacts",JSON.stringify(j)),c.show("Contact Updated","success"),d.path("../")}},"delete":function(a){if(navigator.onLine){var b=f+"/"+a;g("DELETE",b,null,!0)}else{var d=JSON.parse(localStorage.getItem("contacts")),e=JSON.parse(localStorage.getItem("contactsDeleted")),i=h(d,a);if(d.splice(i,1),e)e.push(a),localStorage.setItem("contactsDeleted",JSON.stringify(e));else{var j=[];j.push(a),localStorage.setItem("contactsDeleted",JSON.stringify(j))}localStorage.setItem("contacts",JSON.stringify(d)),c.show("Contact Deleted","success")}}}}]),angular.module("ContactManager").controller("HomeCtrl",["$scope","contactService",function(a,b){var c=function(){b.list().then(function(b){a.contacts=b.data?b.data.contacts:b})};c(),a.delete=function(a,d){var e=confirm('You are about to delete contact for"'+a+'". Proceed ?');e&&(b.delete(d),c())}}]),angular.module("ContactManager").controller("AddCtrl",["$scope","contactService","$location",function(a,b){a.addContact=function(){b.newContact($.param({contact_name:a.inputName,contact_phone:a.inputPhone,contact_email:a.inputEmail}))}}]),angular.module("ContactManager").controller("EditCtrl",["$scope","contactService","$routeParams","$location",function(a,b,c){b.get(c.id).then(function(b){b=b.contacts?b.contacts:b[0],a.inputName=b.contact_name,a.inputPhone=b.contact_phone,a.inputEmail=b.contact_email,a.id=b.id,a.editPage=!0}),a.addContact=function(){b.update(c.id,$.param({contact_name:a.inputName,contact_phone:a.inputPhone,contact_email:a.inputEmail,id:a.id}))}}]);